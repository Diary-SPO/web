var e=Object.defineProperty,n=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(n,i,a)=>i in n?e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;import{y as s,F as l,q as _,h as c,e as p,p as v,A as u,T as w}from"./@vkontakte/icons-HJ4wZ9QE.js";import{af as d,aY as f,aZ as m,a5 as h,o as V,n as k,a_ as b,a$ as g,m as y,p as x,q as O,s as S,J as T,r as B,ae as E,v as P,c as W,aQ as N,b0 as j}from"./index--wYC2PF4.js";import{N as X}from"./Panel-fPJSZPud.js";const I=l({entering:!1}),$=({children:e,entering:n})=>{const i=_(I),a=d({entering:i.entering||n});return s(I.Provider,{value:a},e)},C=l(void 0),A=({children:e,isBack:n})=>{const i=_(C),a=void 0!==n?n:i,[r]=c(a);return s(C.Provider,{value:r},e)};const M=(e,n,i)=>({swipedToOpposite:n<0,swipeBackTriggered:n>=10,viewportStartEdgeTouched:e<=20,viewportEndEdgeTouched:e>=i-20}),L={View:"_View_9hasv_1","View--animated":"_View--animated_9hasv_8","View--swiping-back":"_View--swiping-back_9hasv_9",View__panel:"_View__panel_9hasv_13",View__header:"_View__header_9hasv_14",View__panels:"_View__panels_9hasv_20","View__panel-in":"_View__panel-in_9hasv_33","View__panel-overlay":"_View__panel-overlay_9hasv_45","View--ios":"_View--ios_9hasv_61","View__panel--swipe-back-prev":"_View__panel--swipe-back-prev_9hasv_61","View__panel--swipe-back-success":"_View__panel--swipe-back-success_9hasv_61","View__panel--swipe-back-next":"_View__panel--swipe-back-next_9hasv_66","View__panel--swipe-back-failed":"_View__panel--swipe-back-failed_9hasv_71","View__panel--next":"_View__panel--next_9hasv_94","View__panel--prev":"_View__panel--prev_9hasv_94","animation-view-prev-back":"_animation-view-prev-back_9hasv_1","animation-view-next-forward":"_animation-view-next-forward_9hasv_1","View--no-motion":"_View--no-motion_9hasv_102","animation-ios-prev-forward":"_animation-ios-prev-forward_9hasv_1","animation-ios-next-back":"_animation-ios-next-back_9hasv_1","animation-ios-next-forward":"_animation-ios-next-forward_9hasv_1","animation-ios-prev-back":"_animation-ios-prev-back_9hasv_1","animation-ios-fade-in":"_animation-ios-fade-in_9hasv_1","animation-ios-fade-out":"_animation-ios-fade-out_9hasv_1","View__panel--active":"_View__panel--active_9hasv_173"};var q,D;(D=q||(q={}))[D.fail=1]="fail",D[D.success=2]="success";let F={};const J=e=>{var l=e,{activePanel:_,history:d,nav:I,onTransition:C,onSwipeBack:q,onSwipeBackStart:D,onSwipeBackCancel:J,children:K,className:Q}=l,Y=((e,n)=>{var i={};for(var o in e)r.call(e,o)&&n.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&a)for(var o of a(e))n.indexOf(o)<0&&t.call(e,o)&&(i[o]=e[o]);return i})(l,["activePanel","history","nav","onTransition","onSwipeBack","onSwipeBackStart","onSwipeBackCancel","children","className"]);const Z=m({nav:I,id:Y.id}),z=p(F[Z]||{}),G=p(h);v((()=>()=>{Z&&(F[Z]=z.current)}));const H=p({}),{window:R,document:U}=V(),ee=k(),ne=b(),ie=g(),ae=y(),[re,te]=c(!1),[oe,se]=c([_]),[le,_e]=c(_),[ce,pe]=c(void 0),[ve,ue]=c(null),[we,de]=c(null),fe=p(!1),[me,he]=c(void 0),[Ve,ke]=c(0),[be,ge]=c(0),[ye,xe]=c(null),[Oe,Se]=c(null),[Te,Be]=c(null),[Ee,Pe]=c(!1),We=x(_),Ne=x(me),je=x(Ee),Xe=x(Te),Ie=x(Oe),$e=x(C),Ce=u.toArray(K).filter((e=>{const n=m(e.props);return void 0!==n&&oe.includes(n)||n===Oe||n===ye})),Ae=!ne.transitionMotionEnabled||!ie.animate||ae===O.VKCOM,Me=!Ae&&ae===O.IOS&&ne.isWebView&&Boolean(q),Le=e=>null===e?null:H.current[e],qe=w(((e,n)=>{n&&(z.current[e]=0),ue(null),de(null),se([_]),_e(_),te(!1),pe(n),G.current=()=>{null==ee||ee.scrollTo(0,n?z.current[_]:0),C&&C({isBack:n,from:e,to:_})}}),[_,C,ee]);S((()=>{G.current(),G.current=h}),[G.current]);const De=w((e=>{e&&![L["animation-ios-next-forward"],L["animation-ios-prev-back"],L["animation-view-next-forward"],L["animation-view-prev-back"]].includes(e.animationName)||null===ve||qe(ve,Boolean(ce))}),[qe,ce,ve]),{waitTransitionFinish:Fe}=T(),Je=B(De,ae===O.IOS?600:300),Ke=w((()=>{q&&q()}),[q]),Qe=w((()=>{J&&J(),Se(null),xe(null),he(!1),Be(null),ke(0),ge(0)}),[J]),Ye=w((e=>{if(!e||(null==e?void 0:e.propertyName.includes("transform"))&&(null==e?void 0:e.target)===Le(ye))switch(Te){case 1:Qe();break;case 2:Ke()}}),[Qe,Ke,ye,Te]),Ze=e=>{if(!N||!R)return{};const n=e===Oe,i=e===ye;if(!n&&!i||Te)return{};let a=`${be}px`,r=100*be/R.innerWidth/2-50+"%";return i?{transform:`translate3d(${r}, 0, 0)`,WebkitTransform:`translate3d(${r}, 0, 0)`}:n?{transform:`translate3d(${a}, 0, 0)`,WebkitTransform:`translate3d(${a}, 0, 0)`}:{}},ze=e=>{if(!N||!R)return{};if(!(e===ye))return{};const n=1-be/R.innerWidth,i=2===Te?0:1===Te?1:null;return{display:"block",opacity:null===i?n:i}};return v((()=>{if(We&&We!==_&&!Ne&&!je){const e=u.toArray(K).map((e=>m(e.props))).find((e=>e===We||e===_))===_;z.current[We]=null==ee?void 0:ee.getScroll().y,Ae?qe(We,e):(E(U),se([We,_]),ue(We),de(_),_e(null),te(!0),pe(e),j.supported||Je.set())}if(We&&We!==_&&Ne){const e=_,n=We;Ie&&(z.current[Ie]=0),Se(null),xe(null),he(!1),Be(null),ke(0),ge(0),_e(e),se([e]),pe(!0),G.current=()=>{null!==e&&(null==ee||ee.scrollTo(0,z.current[e])),$e&&$e({isBack:!0,from:n,to:e})}}!Xe&&Te&&Fe(Le(ye),Ye,ae===O.IOS?600:300),1!==Xe||Te||null===le||null==ee||ee.scrollTo(0,z.current[le]),We!==_&&Ee&&(Pe(!1),de(null),ue(null),te(!1),se([_]),_e(_))}),[_,le,Je,Ee,K,Ae,U,qe,ae,We,je,$e,Ie,Xe,Ne,ee,ye,Te,Ye,Fe]),s(X.Provider,{value:Z},s(P,(Ge=((e,n)=>{for(var i in n||(n={}))r.call(n,i)&&o(e,i,n[i]);if(a)for(var i of a(n))t.call(n,i)&&o(e,i,n[i]);return e})({Component:"section"},Y),He={className:W(L.View,ae===O.IOS&&W(L["View--ios"],"vkuiInternalView--ios"),!Ae&&re&&L["View--animated"],!Ae&&me&&L["View--swiping-back"],Ae&&L["View--no-motion"],Q),onMoveX:Me?e=>{if(fe.current||function(e){var n;const i=e.originalEvent.target;return Boolean(null==(n=null==i?void 0:i.closest)?void 0:n.call(i,"input, textarea, [data-vkui-swipe-back=false]"))}(e))return;const{swipedToOpposite:n,swipeBackTriggered:i,viewportStartEdgeTouched:a}=M(e.startX,e.shiftX,R.innerWidth);if(!re||!i){if(!me&&d&&d.length>1){if(n)return void(fe.current=!0);if(!i)return;if(!a&&(r=e.originalEvent.target,f(r).some((e=>"scrollLeft"in e&&e.scrollLeft>0))))return void(fe.current=!0);if(D&&"prevent"===D(le))return void(fe.current=!0);null!==le&&(E(U),z.current[le]=null==ee?void 0:ee.getScroll().y),he(!0),ke(e.startX),Se(le),xe(d.slice(-2)[0])}var r;me&&(e.shiftX<0?ge(0):e.shiftX>R.innerWidth-Ve?ge(R.innerWidth):ge(e.shiftX))}}:ae===O.IOS?e=>{if(Ee)return;const{swipeBackTriggered:n,viewportStartEdgeTouched:i,viewportEndEdgeTouched:a}=M(e.startX,e.shiftX,R.innerWidth);(i||a)&&n&&Pe(!0)}:void 0,onEnd:Me?e=>{var n;if(fe.current=!1,me){const i=be/e.duration*1e3;0===be?Qe():be>=(null!=(n=R.innerWidth)?n:0)?Ke():i>250||be>=R.innerWidth/2?Be(2):Be(1)}}:void 0},n(Ge,i(He))),s("div",{className:L.View__panels},Ce.map((e=>{var n;const i=m(e.props),a=re&&i===(ce?ve:we),r=i===ve||i===Oe||i===ye||i===we&&ce;return s("div",{className:W(L.View__panel,i===le&&L["View__panel--active"],i===ve&&L["View__panel--prev"],i===we&&L["View__panel--next"],i===Oe&&L["View__panel--swipe-back-prev"],i===ye&&L["View__panel--swipe-back-next"],2===Te&&L["View__panel--swipe-back-success"],1===Te&&L["View__panel--swipe-back-failed"]),onAnimationEnd:a?De:void 0,ref:e=>void 0!==i&&(H.current[i]=e),style:Ze(i),key:i},ae===O.IOS&&s("div",{className:L["View__panel-overlay"],style:ze(i)}),s("div",{className:L["View__panel-in"],style:{marginTop:r?-(null!=(n=z.current[i])?n:0):void 0}},s(A,{isBack:me||ce},s($,{entering:i===we||i===ye},e))))})))));var Ge,He};export{J as V};
