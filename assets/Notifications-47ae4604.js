import{o as e,D as t,G as a,aa as i,H as n,a4 as r,C as o,h as l,T as s,g as c,d,L as h}from"./index-716dd2fc.js";import{B as m}from"./Button-9144f7df.js";import{P as p}from"./Panel-eb4ddde2.js";import{B as g}from"./ButtonGroup-80014e6a.js";import{h as u,p as v,Q as f}from"./@vkontakte/icons-d137ec12.js";import{m as k,h as S}from"./makeRequest-d3f44c26.js";import{P as j}from"./PanelHeaderWithBack-cc3484e7.js";import{u as y}from"./useSnackbar-8d09d7d9.js";import"./Snackbar-3177c796.js";const w=({id:w})=>{const[A,B]=u(null),[D,I]=u(!1),[P,x]=u(!1),[C,F]=y(),_=()=>{I(!1),x(!0)},b=async t=>{I(!0);try{if(t){const e=await(async()=>k("/ads"))();S(e,_,_,(()=>{I(!1),x(!1)}),F),(e=>{localStorage.setItem("savedAds",JSON.stringify(e)),localStorage.setItem("lastFetchTime",String(Date.now()))})(e),B(e)}else{const e=JSON.parse(localStorage.getItem("savedAds")||"");B(e)}I(!1)}catch(t){I(!1),F({icon:e(f,{fill:"var(--vkui--color_icon_negative)"}),title:"Ошибка при попытке загрузить объявления",action:"Попробовать снова",onActionClick:()=>b(!0)})}};return v((()=>{const e=localStorage.getItem("savedAds");e?(B(JSON.parse(e)),F({title:"Данные взяты из кеша",action:"Загрузить новые",onActionClick:()=>b(!0)})):b(!0)}),[]),e(p,{nav:w,children:[e(j,{title:"Объявления"}),e(t,{children:[A&&(null==A?void 0:A.length)>0&&(null==A?void 0:A.map((({title:c,id:d,date:h,isForEmployees:m,isForParents:p,isForStudents:g,deleteInDays:u,text:v})=>e(a,{description:e("div",{style:{display:"flex",gap:10},children:[m&&e(i,{children:"Для работников"}),p&&e(i,{color:"yellow-outline",children:"Для родителей"}),g&&e(i,{color:"green-outline",children:"Для студентов"})]}),header:e(n,{mode:"tertiary",aside:e(r,{children:["Удалится через ",u," дней"]}),children:new Date(h).toLocaleDateString()}),children:e(o,{mode:"shadow",children:e(t,{children:[e(l,{level:"3",children:c}),e(s,{children:v})]})})},d)))),e(t,{children:D&&e(t,{children:e(c,{})})}),e(t,{children:P&&e(d,{header:"Ошибка при загрузке",action:e(g,{mode:"vertical",align:"center",children:[e(m,{size:"s",onClick:()=>b(!0),children:"Попробовать снова"}),e(h,{href:"https://vk.me/dnevnik_spo",target:"_blank",children:"Сообщить о проблеме"})]})})}),e(t,{children:A&&(null==A?void 0:A.length)<1&&e(d,{header:"Объявлений нет"})})]}),C]})};export{w as default};
