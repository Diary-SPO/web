var e=Object.defineProperty,n=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(n,i,a)=>i in n?e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;import{y as s,F as l,q as c,h as _,b as p,p as v,A as u,T as w}from"./@vkontakte/icons-Hmxnb1rK.js";import{ag as d,aQ as f,aR as m,a6 as h,o as V,n as k,aS as b,aT as g,m as y,p as S,q as x,s as O,J as T,r as B,af as E,v as P,c as W,aI as N,aU as j}from"./index-V8iVre27.js";import{N as I}from"./Panel-QWgBTGN8.js";const X=l({entering:!1}),$=({children:e,entering:n})=>{const i=c(X),a=d({entering:i.entering||n});return s(X.Provider,{value:a},e)},C=l(void 0),A=({children:e,isBack:n})=>{const i=c(C),a=void 0!==n?n:i,[r]=_(a);return s(C.Provider,{value:r},e)};const M=(e,n,i)=>({swipedToOpposite:n<0,swipeBackTriggered:n>=10,viewportStartEdgeTouched:e<=20,viewportEndEdgeTouched:e>=i-20}),L={View:"_View_9hasv_1","View--animated":"_View--animated_9hasv_8","View--swiping-back":"_View--swiping-back_9hasv_9",View__panel:"_View__panel_9hasv_13",View__header:"_View__header_9hasv_14",View__panels:"_View__panels_9hasv_20","View__panel-in":"_View__panel-in_9hasv_33","View__panel-overlay":"_View__panel-overlay_9hasv_45","View--ios":"_View--ios_9hasv_61","View__panel--swipe-back-prev":"_View__panel--swipe-back-prev_9hasv_61","View__panel--swipe-back-success":"_View__panel--swipe-back-success_9hasv_61","View__panel--swipe-back-next":"_View__panel--swipe-back-next_9hasv_66","View__panel--swipe-back-failed":"_View__panel--swipe-back-failed_9hasv_71","View__panel--next":"_View__panel--next_9hasv_94","View__panel--prev":"_View__panel--prev_9hasv_94","animation-view-prev-back":"_animation-view-prev-back_9hasv_1","animation-view-next-forward":"_animation-view-next-forward_9hasv_1","View--no-motion":"_View--no-motion_9hasv_102","animation-ios-prev-forward":"_animation-ios-prev-forward_9hasv_1","animation-ios-next-back":"_animation-ios-next-back_9hasv_1","animation-ios-next-forward":"_animation-ios-next-forward_9hasv_1","animation-ios-prev-back":"_animation-ios-prev-back_9hasv_1","animation-ios-fade-in":"_animation-ios-fade-in_9hasv_1","animation-ios-fade-out":"_animation-ios-fade-out_9hasv_1","View__panel--active":"_View__panel--active_9hasv_173"};var q,D;(D=q||(q={}))[D.fail=1]="fail",D[D.success=2]="success";let F={};const J=e=>{var l=e,{activePanel:c,history:d,nav:X,onTransition:C,onSwipeBack:q,onSwipeBackStart:D,onSwipeBackCancel:J,children:K,className:Q}=l,R=((e,n)=>{var i={};for(var o in e)r.call(e,o)&&n.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&a)for(var o of a(e))n.indexOf(o)<0&&t.call(e,o)&&(i[o]=e[o]);return i})(l,["activePanel","history","nav","onTransition","onSwipeBack","onSwipeBackStart","onSwipeBackCancel","children","className"]);const U=m({nav:X,id:R.id}),z=p(F[U]||{}),G=p(h);v((()=>()=>{U&&(F[U]=z.current)}));const H=p({}),{window:Y,document:Z}=V(),ee=k(),ne=b(),ie=g(),ae=y(),[re,te]=_(!1),[oe,se]=_([c]),[le,ce]=_(c),[_e,pe]=_(void 0),[ve,ue]=_(null),[we,de]=_(null),fe=p(!1),[me,he]=_(void 0),[Ve,ke]=_(0),[be,ge]=_(0),[ye,Se]=_(null),[xe,Oe]=_(null),[Te,Be]=_(null),[Ee,Pe]=_(!1),We=S(c),Ne=S(me),je=S(Ee),Ie=S(Te),Xe=S(xe),$e=S(C),Ce=u.toArray(K).filter((e=>{const n=m(e.props);return void 0!==n&&oe.includes(n)||n===xe||n===ye})),Ae=!ne.transitionMotionEnabled||!ie.animate||ae===x.VKCOM,Me=!Ae&&ae===x.IOS&&ne.isWebView&&Boolean(q),Le=e=>null===e?null:H.current[e],qe=w(((e,n)=>{n&&(z.current[e]=0),ue(null),de(null),se([c]),ce(c),te(!1),pe(n),G.current=()=>{null==ee||ee.scrollTo(0,n?z.current[c]:0),C&&C({isBack:n,from:e,to:c})}}),[c,C,ee]);O((()=>{G.current(),G.current=h}),[G.current]);const De=w((e=>{e&&![L["animation-ios-next-forward"],L["animation-ios-prev-back"],L["animation-view-next-forward"],L["animation-view-prev-back"]].includes(e.animationName)||null===ve||qe(ve,Boolean(_e))}),[qe,_e,ve]),{waitTransitionFinish:Fe}=T(),Je=B(De,ae===x.IOS?600:300),Ke=w((()=>{q&&q()}),[q]),Qe=w((()=>{J&&J(),Oe(null),Se(null),he(!1),Be(null),ke(0),ge(0)}),[J]),Re=w((e=>{if(!e||(null==e?void 0:e.propertyName.includes("transform"))&&(null==e?void 0:e.target)===Le(ye))switch(Te){case 1:Qe();break;case 2:Ke()}}),[Qe,Ke,ye,Te]),Ue=e=>{if(!N||!Y)return{};const n=e===xe,i=e===ye;if(!n&&!i||Te)return{};let a=`${be}px`,r=100*be/Y.innerWidth/2-50+"%";return i?{transform:`translate3d(${r}, 0, 0)`,WebkitTransform:`translate3d(${r}, 0, 0)`}:n?{transform:`translate3d(${a}, 0, 0)`,WebkitTransform:`translate3d(${a}, 0, 0)`}:{}},ze=e=>{if(!N||!Y)return{};if(!(e===ye))return{};const n=1-be/Y.innerWidth,i=2===Te?0:1===Te?1:null;return{display:"block",opacity:null===i?n:i}};return v((()=>{if(We&&We!==c&&!Ne&&!je){const e=u.toArray(K).map((e=>m(e.props))).find((e=>e===We||e===c))===c;z.current[We]=null==ee?void 0:ee.getScroll().y,Ae?qe(We,e):(E(Z),se([We,c]),ue(We),de(c),ce(null),te(!0),pe(e),j.supported||Je.set())}if(We&&We!==c&&Ne){const e=c,n=We;Xe&&(z.current[Xe]=0),Oe(null),Se(null),he(!1),Be(null),ke(0),ge(0),ce(e),se([e]),pe(!0),G.current=()=>{null!==e&&(null==ee||ee.scrollTo(0,z.current[e])),$e&&$e({isBack:!0,from:n,to:e})}}!Ie&&Te&&Fe(Le(ye),Re,ae===x.IOS?600:300),1!==Ie||Te||null===le||null==ee||ee.scrollTo(0,z.current[le]),We!==c&&Ee&&(Pe(!1),de(null),ue(null),te(!1),se([c]),ce(c))}),[c,le,Je,Ee,K,Ae,Z,qe,ae,We,je,$e,Xe,Ie,Ne,ee,ye,Te,Re,Fe]),s(I.Provider,{value:U},s(P,(Ge=((e,n)=>{for(var i in n||(n={}))r.call(n,i)&&o(e,i,n[i]);if(a)for(var i of a(n))t.call(n,i)&&o(e,i,n[i]);return e})({Component:"section"},R),He={className:W(L.View,ae===x.IOS&&W(L["View--ios"],"vkuiInternalView--ios"),!Ae&&re&&L["View--animated"],!Ae&&me&&L["View--swiping-back"],Ae&&L["View--no-motion"],Q),onMoveX:Me?e=>{if(fe.current||function(e){var n;const i=e.originalEvent.target;return Boolean(null==(n=null==i?void 0:i.closest)?void 0:n.call(i,"input, textarea, [data-vkui-swipe-back=false]"))}(e))return;const{swipedToOpposite:n,swipeBackTriggered:i,viewportStartEdgeTouched:a}=M(e.startX,e.shiftX,Y.innerWidth);if(!re||!i){if(!me&&d&&d.length>1){if(n)return void(fe.current=!0);if(!i)return;if(!a&&(r=e.originalEvent.target,f(r).some((e=>"scrollLeft"in e&&e.scrollLeft>0))))return void(fe.current=!0);if(D&&"prevent"===D(le))return void(fe.current=!0);null!==le&&(E(Z),z.current[le]=null==ee?void 0:ee.getScroll().y),he(!0),ke(e.startX),Oe(le),Se(d.slice(-2)[0])}var r;me&&(e.shiftX<0?ge(0):e.shiftX>Y.innerWidth-Ve?ge(Y.innerWidth):ge(e.shiftX))}}:ae===x.IOS?e=>{if(Ee)return;const{swipeBackTriggered:n,viewportStartEdgeTouched:i,viewportEndEdgeTouched:a}=M(e.startX,e.shiftX,Y.innerWidth);(i||a)&&n&&Pe(!0)}:void 0,onEnd:Me?e=>{var n;if(fe.current=!1,me){const i=be/e.duration*1e3;0===be?Qe():be>=(null!=(n=Y.innerWidth)?n:0)?Ke():i>250||be>=Y.innerWidth/2?Be(2):Be(1)}}:void 0},n(Ge,i(He))),s("div",{className:L.View__panels},Ce.map((e=>{var n;const i=m(e.props),a=re&&i===(_e?ve:we),r=i===ve||i===xe||i===ye||i===we&&_e;return s("div",{className:W(L.View__panel,i===le&&L["View__panel--active"],i===ve&&L["View__panel--prev"],i===we&&L["View__panel--next"],i===xe&&L["View__panel--swipe-back-prev"],i===ye&&L["View__panel--swipe-back-next"],2===Te&&L["View__panel--swipe-back-success"],1===Te&&L["View__panel--swipe-back-failed"]),onAnimationEnd:a?De:void 0,ref:e=>void 0!==i&&(H.current[i]=e),style:Ue(i),key:i},ae===x.IOS&&s("div",{className:L["View__panel-overlay"],style:ze(i)}),s("div",{className:L["View__panel-in"],style:{marginTop:r?-(null!=(n=z.current[i])?n:0):void 0}},s(A,{isBack:me||_e},s($,{entering:i===we||i===ye},e))))})))));var Ge,He};export{J as V};
