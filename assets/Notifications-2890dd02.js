import{o as e,D as t,G as a,ac as i,H as r,a6 as n,C as s,j as o,T as l,i as c,d,L as h}from"./index-12fcb1ba.js";import{B as m}from"./Button-a58ba127.js";import{P as p}from"./Panel-b4539d2d.js";import{B as g}from"./ButtonGroup-bf903ce8.js";import{h as f,p as k,V as u}from"./@vkontakte/icons-ec9bb119.js";import{m as v,h as S}from"./makeRequest-ee026c1c.js";import{P as j}from"./PanelHeaderWithBack-57ddcc92.js";import{u as y}from"./useSnackbar-10f2a8ee.js";import"./Snackbar-9cb98137.js";const w=({id:w})=>{const[A,B]=f(null),[D,I]=f(!1),[P,x]=f(!1),[C,F]=y(),_=()=>{I(!1),x(!0)},b=async t=>{I(!0);try{if(t){const e=await(async()=>v("/ads"))();S(e,_,_,(()=>{I(!1),x(!1)}),F),(e=>{localStorage.setItem("savedAds",JSON.stringify(e)),localStorage.setItem("lastFetchTime",String(Date.now()))})(e),B(e)}else{const e=JSON.parse(localStorage.getItem("savedAds")||"");B(e)}I(!1)}catch(t){I(!1),F({icon:e(u,{fill:"var(--vkui--color_icon_negative)"}),title:"Ошибка при попытке загрузить объявления",action:"Попробовать снова",onActionClick:()=>b(!0)})}};return k((()=>{const e=localStorage.getItem("savedAds");e?(B(JSON.parse(e)),F({title:"Данные взяты из кеша",action:"Загрузить новые",onActionClick:()=>b(!0)})):b(!0)}),[]),e(p,{nav:w,children:[e(j,{title:"Объявления"}),e(t,{children:[A&&A?.length>0&&A?.map((({title:c,id:d,date:h,isForEmployees:m,isForParents:p,isForStudents:g,deleteInDays:f,text:k})=>e(a,{description:e("div",{style:{display:"flex",gap:10},children:[m&&e(i,{children:"Для работников"}),p&&e(i,{color:"yellow-outline",children:"Для родителей"}),g&&e(i,{color:"green-outline",children:"Для студентов"})]}),header:e(r,{mode:"tertiary",aside:e(n,{children:["Удалится через ",f," дней"]}),children:new Date(h).toLocaleDateString()}),children:e(s,{mode:"shadow",children:e(t,{children:[e(o,{level:"3",children:c}),e(l,{children:k})]})})},d))),e(t,{children:D&&e(t,{children:e(c,{})})}),e(t,{children:P&&e(d,{header:"Ошибка при загрузке",action:e(g,{mode:"vertical",align:"center",children:[e(m,{size:"s",onClick:()=>b(!0),children:"Попробовать снова"}),e(h,{href:"https://vk.me/dnevnik_spo",target:"_blank",children:"Сообщить о проблеме"})]})})}),e(t,{children:A&&A?.length<1&&e(d,{header:"Объявлений нет"})})]}),C]})};export{w as default};
