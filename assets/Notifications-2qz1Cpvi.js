import{u as e,G as t,a7 as a,H as i,a1 as r,C as o,h as n,T as s,k as l,e as c,L as d}from"./index--wYC2PF4.js";import{B as h}from"./Button-YcANNQ5j.js";import{P as m}from"./Panel-fPJSZPud.js";import{B as p}from"./ButtonGroup-8HutliAu.js";import{D as f}from"./Div-8NhnMoi4.js";import{h as v,p as g,W as u}from"./@vkontakte/icons-HJ4wZ9QE.js";import{h as k}from"./handleResponse-kGkHOE9v.js";import{P as S}from"./PanelHeaderWithBack-EZo8V8Fv.js";import{u as j}from"./useSnackbar-1tYziyFU.js";import{m as y}from"./makeRequest-NP7h63fm.js";import"./Snackbar-HLSVggkW.js";const D=({id:D})=>{const[w,A]=v(null),[B,I]=v(!1),[P,x]=v(!1),[C,F]=j(),_=()=>{I(!1),x(!0)},b=async t=>{I(!0);try{if(t){const e=await(async()=>y("/ads"))();k(e,_,_,(()=>{I(!1),x(!1)}),F),(e=>{localStorage.setItem("savedAds",JSON.stringify(e)),localStorage.setItem("lastFetchTime",String(Date.now()))})(e),A(e)}else{const e=JSON.parse(localStorage.getItem("savedAds")||"");A(e)}I(!1)}catch(t){I(!1),F({icon:e(u,{fill:"var(--vkui--color_icon_negative)"}),title:"Ошибка при попытке загрузить объявления",action:"Попробовать снова",onActionClick:()=>b(!0)})}};return g((()=>{const e=localStorage.getItem("savedAds");e?(A(JSON.parse(e)),F({title:"Данные взяты из кеша",action:"Загрузить новые",onActionClick:()=>b(!0)})):b(!0)}),[]),e(m,{nav:D,children:[e(S,{title:"Объявления"}),e(f,{children:[w&&(null==w?void 0:w.length)>0&&(null==w?void 0:w.map((({title:l,id:c,date:d,isForEmployees:h,isForParents:m,isForStudents:p,deleteInDays:v,text:g})=>e(t,{description:e("div",{style:{display:"flex",gap:10},children:[h&&e(a,{children:"Для работников"}),m&&e(a,{color:"yellow-outline",children:"Для родителей"}),p&&e(a,{color:"green-outline",children:"Для студентов"})]}),header:e(i,{mode:"tertiary",aside:e(r,{children:["Удалится через ",v," дней"]}),children:new Date(d).toLocaleDateString()}),children:e(o,{mode:"shadow",children:e(f,{children:[e(n,{level:"3",children:l}),e(s,{children:g})]})})},c)))),e(f,{children:B&&e(f,{children:e(l,{})})}),e(f,{children:P&&e(c,{header:"Ошибка при загрузке",action:e(p,{mode:"vertical",align:"center",children:[e(h,{size:"s",onClick:()=>b(!0),children:"Попробовать снова"}),e(d,{href:"https://vk.me/dnevnik_spo",target:"_blank",children:"Сообщить о проблеме"})]})})}),e(f,{children:w&&(null==w?void 0:w.length)<1&&e(c,{header:"Объявлений нет"})})]}),C]})};export{D as default};
