import{u as e,G as t,a8 as i,H as a,a2 as r,C as o,i as n,T as l,h as s,e as c,L as d}from"./index-V8iVre27.js";import{B as h}from"./Button-bI8mAd_C.js";import{P as m}from"./Panel-QWgBTGN8.js";import{B as p}from"./ButtonGroup-4bg9PBfe.js";import{D as v}from"./Div-aB5xY7rY.js";import{h as f,p as g,V as u}from"./@vkontakte/icons-Hmxnb1rK.js";import{m as k,h as S}from"./makeRequest-hnqlHHd1.js";import{P as j}from"./PanelHeaderWithBack-MH-2GNqv.js";import{u as y}from"./useSnackbar-VhiceFc0.js";import"./Snackbar-a9j_Cux_.js";const D=({id:D})=>{const[w,A]=f(null),[B,I]=f(!1),[P,x]=f(!1),[C,F]=y(),_=()=>{I(!1),x(!0)},b=async t=>{I(!0);try{if(t){const e=await(async()=>k("/ads"))();S(e,_,_,(()=>{I(!1),x(!1)}),F),(e=>{localStorage.setItem("savedAds",JSON.stringify(e)),localStorage.setItem("lastFetchTime",String(Date.now()))})(e),A(e)}else{const e=JSON.parse(localStorage.getItem("savedAds")||"");A(e)}I(!1)}catch(t){I(!1),F({icon:e(u,{fill:"var(--vkui--color_icon_negative)"}),title:"Ошибка при попытке загрузить объявления",action:"Попробовать снова",onActionClick:()=>b(!0)})}};return g((()=>{const e=localStorage.getItem("savedAds");e?(A(JSON.parse(e)),F({title:"Данные взяты из кеша",action:"Загрузить новые",onActionClick:()=>b(!0)})):b(!0)}),[]),e(m,{nav:D,children:[e(j,{title:"Объявления"}),e(v,{children:[w&&(null==w?void 0:w.length)>0&&(null==w?void 0:w.map((({title:s,id:c,date:d,isForEmployees:h,isForParents:m,isForStudents:p,deleteInDays:f,text:g})=>e(t,{description:e("div",{style:{display:"flex",gap:10},children:[h&&e(i,{children:"Для работников"}),m&&e(i,{color:"yellow-outline",children:"Для родителей"}),p&&e(i,{color:"green-outline",children:"Для студентов"})]}),header:e(a,{mode:"tertiary",aside:e(r,{children:["Удалится через ",f," дней"]}),children:new Date(d).toLocaleDateString()}),children:e(o,{mode:"shadow",children:e(v,{children:[e(n,{level:"3",children:s}),e(l,{children:g})]})})},c)))),e(v,{children:B&&e(v,{children:e(s,{})})}),e(v,{children:P&&e(c,{header:"Ошибка при загрузке",action:e(p,{mode:"vertical",align:"center",children:[e(h,{size:"s",onClick:()=>b(!0),children:"Попробовать снова"}),e(d,{href:"https://vk.me/dnevnik_spo",target:"_blank",children:"Сообщить о проблеме"})]})})}),e(v,{children:w&&(null==w?void 0:w.length)<1&&e(c,{header:"Объявлений нет"})})]}),C]})};export{D as default};
