import{y as e,G as i,q as n,h as a,b as r,p as t,O as s,T as o}from"./@vkontakte/icons-ec9bb119.js";import{ak as _,aV as l,aW as c,aa as p,q as w,p as v,aX as u,aY as d,n as f,r as m,s as V,v as h,Q as k,t as b,aj as g,x,c as T,aN as y,aZ as S}from"./index-12fcb1ba.js";import{N as B}from"./Panel-b4539d2d.js";const E=i({entering:!1}),W=({children:i,entering:a})=>{const r=n(E),t=_({entering:r.entering||a});return e(E.Provider,{value:t},i)},N=i(void 0),X=({children:i,isBack:r})=>{const t=n(N),s=void 0!==r?r:t,[o]=a(s);return e(N.Provider,{value:o},i)};const O=(e,i,n)=>({swipedToOpposite:i<0,swipeBackTriggered:i>=10,viewportStartEdgeTouched:e<=20,viewportEndEdgeTouched:e>=n-20}),I={View:"_View_9hasv_1","View--animated":"_View--animated_9hasv_8","View--swiping-back":"_View--swiping-back_9hasv_9",View__panel:"_View__panel_9hasv_13",View__header:"_View__header_9hasv_14",View__panels:"_View__panels_9hasv_20","View__panel-in":"_View__panel-in_9hasv_33","View__panel-overlay":"_View__panel-overlay_9hasv_45","View--ios":"_View--ios_9hasv_61","View__panel--swipe-back-prev":"_View__panel--swipe-back-prev_9hasv_61","View__panel--swipe-back-success":"_View__panel--swipe-back-success_9hasv_61","View__panel--swipe-back-next":"_View__panel--swipe-back-next_9hasv_66","View__panel--swipe-back-failed":"_View__panel--swipe-back-failed_9hasv_71","View__panel--next":"_View__panel--next_9hasv_94","View__panel--prev":"_View__panel--prev_9hasv_94","animation-view-prev-back":"_animation-view-prev-back_9hasv_1","animation-view-next-forward":"_animation-view-next-forward_9hasv_1","View--no-motion":"_View--no-motion_9hasv_102","animation-ios-prev-forward":"_animation-ios-prev-forward_9hasv_1","animation-ios-next-back":"_animation-ios-next-back_9hasv_1","animation-ios-next-forward":"_animation-ios-next-forward_9hasv_1","animation-ios-prev-back":"_animation-ios-prev-back_9hasv_1","animation-ios-fade-in":"_animation-ios-fade-in_9hasv_1","animation-ios-fade-out":"_animation-ios-fade-out_9hasv_1","View__panel--active":"_View__panel--active_9hasv_173"};var P;!function(e){e[e.fail=1]="fail",e[e.success=2]="success"}(P||(P={}));let $={};const j=({activePanel:i,history:n,nav:_,onTransition:E,onSwipeBack:N,onSwipeBackStart:P,onSwipeBackCancel:j,children:A,className:C,...M})=>{const L=c({nav:_,id:M.id}),q=r($[L]||{}),F=r(p);t((()=>()=>{L&&($[L]=q.current)}));const K=r({}),{window:Q,document:Y}=w(),Z=v(),z=u(),D=d(),G=f(),[H,J]=a(!1),[R,U]=a([i]),[ee,ie]=a(i),[ne,ae]=a(void 0),[re,te]=a(null),[se,oe]=a(null),_e=r(!1),[le,ce]=a(void 0),[pe,we]=a(0),[ve,ue]=a(0),[de,fe]=a(null),[me,Ve]=a(null),[he,ke]=a(null),[be,ge]=a(!1),xe=m(i),Te=m(le),ye=m(be),Se=m(he),Be=m(me),Ee=m(E),We=s.toArray(A).filter((e=>{const i=c(e.props);return void 0!==i&&R.includes(i)||i===me||i===de})),Ne=!z.transitionMotionEnabled||!D.animate||G===V.VKCOM,Xe=!Ne&&G===V.IOS&&z.isWebView&&Boolean(N),Oe=e=>null===e?null:K.current[e],Ie=o(((e,n)=>{n&&(q.current[e]=0),te(null),oe(null),U([i]),ie(i),J(!1),ae(n),F.current=()=>{Z?.scrollTo(0,n?q.current[i]:0),E&&E({isBack:n,from:e,to:i})}}),[i,E,Z]);h((()=>{F.current(),F.current=p}),[F.current]);const Pe=o((e=>{e&&![I["animation-ios-next-forward"],I["animation-ios-prev-back"],I["animation-view-next-forward"],I["animation-view-prev-back"]].includes(e.animationName)||null===re||Ie(re,Boolean(ne))}),[Ie,ne,re]),{waitTransitionFinish:$e}=k(),je=b(Pe,G===V.IOS?600:300),Ae=o((()=>{N&&N()}),[N]),Ce=o((()=>{j&&j(),Ve(null),fe(null),ce(!1),ke(null),we(0),ue(0)}),[j]),Me=o((e=>{if(!e||e?.propertyName.includes("transform")&&e?.target===Oe(de))switch(he){case 1:Ce();break;case 2:Ae()}}),[Ce,Ae,de,he]),Le=e=>{if(!y||!Q)return{};const i=e===me,n=e===de;if(!i&&!n||he)return{};let a=`${ve}px`,r=100*ve/Q.innerWidth/2-50+"%";return n?{transform:`translate3d(${r}, 0, 0)`,WebkitTransform:`translate3d(${r}, 0, 0)`}:i?{transform:`translate3d(${a}, 0, 0)`,WebkitTransform:`translate3d(${a}, 0, 0)`}:{}},qe=e=>{if(!y||!Q)return{};if(!(e===de))return{};const i=1-ve/Q.innerWidth,n=2===he?0:1===he?1:null;return{display:"block",opacity:null===n?i:n}};return t((()=>{if(xe&&xe!==i&&!Te&&!ye){const e=s.toArray(A).map((e=>c(e.props))).find((e=>e===xe||e===i)),n=e===i;q.current[xe]=Z?.getScroll().y,Ne?Ie(xe,n):(g(Y),U([xe,i]),te(xe),oe(i),ie(null),J(!0),ae(n),S.supported||je.set())}if(xe&&xe!==i&&Te){const e=i,n=xe;Be&&(q.current[Be]=0),Ve(null),fe(null),ce(!1),ke(null),we(0),ue(0),ie(e),U([e]),ae(!0),F.current=()=>{null!==e&&Z?.scrollTo(0,q.current[e]),Ee&&Ee({isBack:!0,from:n,to:e})}}!Se&&he&&$e(Oe(de),Me,G===V.IOS?600:300),1!==Se||he||null===ee||Z?.scrollTo(0,q.current[ee]),xe!==i&&be&&(ge(!1),oe(null),te(null),J(!1),U([i]),ie(i))}),[i,ee,je,be,A,Ne,Y,Ie,G,xe,ye,Ee,Be,Se,Te,Z,de,he,Me,$e]),e(B.Provider,{value:L},e(x,{Component:"section",...M,className:T(I.View,G===V.IOS&&T(I["View--ios"],"vkuiInternalView--ios"),!Ne&&H&&I["View--animated"],!Ne&&le&&I["View--swiping-back"],Ne&&I["View--no-motion"],C),onMoveX:Xe?e=>{if(_e.current||function(e){const i=e.originalEvent.target;return Boolean(i?.closest?.("input, textarea, [data-vkui-swipe-back=false]"))}(e))return;const{swipedToOpposite:i,swipeBackTriggered:a,viewportStartEdgeTouched:r}=O(e.startX,e.shiftX,Q.innerWidth);if(!H||!a){if(!le&&n&&n.length>1){if(i)return void(_e.current=!0);if(!a)return;if(!r&&(t=e.originalEvent.target,l(t).some((e=>"scrollLeft"in e&&e.scrollLeft>0))))return void(_e.current=!0);if(P){if("prevent"===P(ee))return void(_e.current=!0)}null!==ee&&(g(Y),q.current[ee]=Z?.getScroll().y),ce(!0),we(e.startX),Ve(ee),fe(n.slice(-2)[0])}var t;le&&(e.shiftX<0?ue(0):e.shiftX>Q.innerWidth-pe?ue(Q.innerWidth):ue(e.shiftX))}}:G===V.IOS?e=>{if(be)return;const{swipeBackTriggered:i,viewportStartEdgeTouched:n,viewportEndEdgeTouched:a}=O(e.startX,e.shiftX,Q.innerWidth);(n||a)&&i&&ge(!0)}:void 0,onEnd:Xe?e=>{if(_e.current=!1,le){const i=ve/e.duration*1e3;0===ve?Ce():ve>=(Q.innerWidth??0)?Ae():i>250||ve>=Q.innerWidth/2?ke(2):ke(1)}}:void 0},e("div",{className:I.View__panels},We.map((i=>{const n=c(i.props),a=H&&n===(ne?re:se),r=n===re||n===me||n===de||n===se&&ne;return e("div",{className:T(I.View__panel,n===ee&&I["View__panel--active"],n===re&&I["View__panel--prev"],n===se&&I["View__panel--next"],n===me&&I["View__panel--swipe-back-prev"],n===de&&I["View__panel--swipe-back-next"],2===he&&I["View__panel--swipe-back-success"],1===he&&I["View__panel--swipe-back-failed"]),onAnimationEnd:a?Pe:void 0,ref:e=>void 0!==n&&(K.current[n]=e),style:Le(n),key:n},G===V.IOS&&e("div",{className:I["View__panel-overlay"],style:qe(n)}),e("div",{className:I["View__panel-in"],style:{marginTop:r?-(q.current[n]??0):void 0}},e(X,{isBack:le||ne},e(W,{entering:n===se||n===de},i))))})))))};export{j as V};
